var e=e=>e.match(/[^\s]|$/m).index+1,t=(t,i,n=1)=>{let s=t.reduce(((t,s,l)=>{const o=e(s);return o>=n&&o<t.col?{line:l+i,col:o}:o===t.col?{line:l+i,col:t.col}:t}),{line:1/0,col:1/0});return isFinite(s.line)&&isFinite(s.col)||(s={line:i+t.length+1,col:1}),s},i="undefined"==typeof document||void 0===document.execCommand?(e,t=document.activeElement)=>t.value=t.value.slice(0,t.selectionStart)+e+t.value.slice(t.selectionEnd):e=>document.execCommand("insertText",!1,e),n={tabStyle:"spaces",tabSize:2,comments:["//","/*","*/"]},s=class{#e;insert;options;constructor(e,t,i={}){this.#e=e,this.insert=t,this.options=Object.assign({},n,i)}get value(){return this.#e.value}get tab(){return"tabs"===this.options.tabStyle?"\t":" ".repeat(this.options.tabSize)}get numberOfLines(){return~this.value.indexOf("\n")&&this.value.split("\n").length||1}static lineAt(e,t){return e.split(/\n/).at(t)}lineAt(e){return s.lineAt(this.value,e)}scrollIntoView(e){const{selectionStart:t,selectionEnd:i,selectionDirection:n}=this.#e;null==e&&(e="forward"===n?i:t),this.#e.setSelectionRange(e,e),this.#e.blur(),this.#e.focus(),this.#e.setSelectionRange(t,i,n)}getRange(){const{selectionStart:e,selectionEnd:t,selectionDirection:i}=this.#e,[n,s]=[e,t].map(this.getLineCol),[l,o]="forward"===i?[s,n]:[n,s];return{start:n,end:s,head:l,tail:o,hasSelection:e!==t,selectionStart:e,selectionEnd:t,selectionDirection:i}}getLineCol=e=>s.getLineCol(this.value,e);static getLineCol(e,t){let i=1,n=1;for(let s=0;s<t;s++)"\n"===e.charAt(s)&&(i++,n=0),n++;return{line:i,col:n}}getPositionFromLineCol(e){return s.getPositionFromLineCol(this.value,e)}static getPositionFromLineCol(e,t){const{line:i,col:n}=t,s=e.split("\n");if(i>s.length)return e.length;if(i<1)return 0;const l=s.slice(0,i);return l[l.length-1]=l.at(-1).slice(0,Math.max(1,n)-1),l.join("\n").length}getArea({start:e,end:t}){return[this.getPositionFromLineCol(e),this.getPositionFromLineCol(t)]}setSelectionRange(e,t,i){e=Math.max(0,e),t=Math.min(this.value.length,t),this.#e.setSelectionRange(e,t,i)}moveCaretTo({line:e,col:t},i,n=this.#e.selectionDirection){const s=this.getPositionFromLineCol({line:e,col:t}),l=i?this.getPositionFromLineCol(i):s;if(i){const e=Math["backward"===n?"min":"max"](s,l);this.setSelectionRange(e,e),this.scrollIntoView()}this.setSelectionRange(Math.min(s,l),Math.max(s,l),s<l?"backward":"forward"),this.scrollIntoView()}replaceBlock(e){const{start:t,end:i,hasSelection:n,selectionDirection:s}=this.getRange(),l=this.lineAt(t.line-1),o=this.lineAt(i.line-1),r=i.col>1||!n?1:0,c=this.getPositionFromLineCol({line:t.line,col:1}),a=this.getPositionFromLineCol({line:i.line+r,col:1}),h=this.value.slice(c,a),{diff:g,text:f,left:u}=e(h,t.line);if(f.length===a-c)return;this.setSelectionRange(c,a),this.insert(f),this.scrollIntoView(this.getPositionFromLineCol({line:i.line-+!r,col:u.col+g}));const m=!n&&t.col<=u.col+g&&i.col<=u.col+g&&0!==l.length,d=this.lineAt(t.line-1)===l||m?t.col:t.col+g,p=m||this.lineAt(i.line-1)===o?i.col:0===h.length?i.col+g:Math.max(1+(t.line!==i.line?r:0),i.col+r*g);this.setSelectionRange(this.getPositionFromLineCol({line:t.line,col:d}),this.getPositionFromLineCol({line:i.line,col:p}),s)}toggleSingleComment(){const e=this.options.comments[0];this.replaceBlock(((i,n)=>{const s=t(i.split("\n").filter((e=>e.length)),n);let l;return i.trimStart().slice(0,2)===e?(l=-3,i=i.replace(new RegExp(`^([^/]*)${e} ?`,"gm"),"$1")):(l=3,i=0===i.length?e+" ":i.replace(new RegExp(`^(?!$)([^/]{0,${s.col-1}})`,"gm"),`$1${e} `)),{diff:l,text:i,left:s}}))}toggleDoubleComment(){let{selectionStart:e,selectionEnd:t,selectionDirection:i}=this.getRange(),n=this.value.slice(e,t);const s=this.options.comments,l=this.value.slice(e-s[1].length,t+s[2].length);if(0===l.indexOf(s[1])&&l.lastIndexOf(s[2])===l.length-s[2].length&&(n=l,e-=s[1].length,t+=s[2].length,this.setSelectionRange(e,t,i)),0===n.indexOf(s[1])&&n.lastIndexOf(s[2])===n.length-s[2].length){const l=n.slice(s[1].length,-s[2].length);this.insert(l),this.setSelectionRange(e,t-s[1].length-s[2].length,i)}else{this.insert(s[1]+n+s[2]);const l=s[1].length;this.setSelectionRange(e+l,t+l,i)}this.scrollIntoView()}indent(e){this.replaceBlock(((i,n)=>{const s=t(i.split("\n"),n,2);let l;return e?(l=-this.options.tabSize,i=i.replace(new RegExp(`^(\t| {1,${this.options.tabSize}})`,"gm"),"")):(l=+this.options.tabSize,i=0===i.length?this.tab:i.replace(/^[^\n]/gm,`${this.tab}$&`)),{diff:l,text:i,left:s}}))}moveCaretHome(t){const{head:i,tail:n}=this.getRange();let s=e(this.lineAt(i.line-1));i.col===s&&(s=1),this.moveCaretTo({line:i.line,col:s},t?n:null)}moveCaretEnd(e){const{head:t,tail:i}=this.getRange();this.moveCaretTo({line:t.line,col:this.lineAt(t.line-1).length+1},e?i:null)}moveCaretLines(e,t){const{head:i,tail:n}=this.getRange(),{numberOfLines:s}=this;let l=i.line+e;l<1&&i.line>1?l=1:l>s&&i.line<s&&(l=s),this.moveCaretTo({line:l,col:i.col},t?n:null)}moveLines(e){const{start:t,end:i,hasSelection:n,selectionStart:s,selectionEnd:l,selectionDirection:o}=this.getRange(),r=this.value.split("\n"),c=1===i.col&&n?1:0,a=e>0;let h=t.line+(a?0:e),g=i.line+(a?e:0)-c;if(a){const t=g-r.length;t>0&&(g-=t,e-=t)}else{const t=1-h;t>0&&(h+=t,e+=t)}if(!e)return;const f={start:{line:h,col:1},end:{line:g,col:this.lineAt(g-1).length+1}},[u,m]=this.getArea(f),d=this.value.slice(u,m).split("\n"),p=a?i.line-c-t.line+1:-e,b=d.slice(0,p),v=d.slice(p);this.setSelectionRange(u,m,o),this.insert(v.concat(b).join("\n"));const S=a?v.join("\n").length+1:-(b.join("\n").length+1),C=s+S,x=l+S;this.setSelectionRange(C,x,o),this.scrollIntoView(a?x:C)}duplicate(){const{start:e,end:t,hasSelection:i,selectionStart:n,selectionEnd:s,selectionDirection:l}=this.getRange(),{numberOfLines:o}=this;i||(e.col=1,t.col=1,t.line++);const[r,c]=this.getArea({start:e,end:t});let a=this.value.slice(r,c);i||"\n"===a.at(-1)||(a=o>1?this.value.slice(r-1,c):"\n"+a),this.setSelectionRange(c,c),this.insert(a);const h=a.length;i?this.setSelectionRange(c,c+h,l):this.setSelectionRange(n+h,s+h),this.scrollIntoView()}deleteLine(){const{start:e,end:t,hasSelection:i}=this.getRange(),{numberOfLines:n}=this,s={line:e.line,col:e.col};i||(t.line<n?(e.col=1,t.col=1,t.line++):1===n?(e.col=1,t.col=this.value.length+1):(s.line--,e.line--,e.col=this.lineAt(t.line-2).length+1,t.col=this.lineAt(t.line-1).length+1));const[l,o]=this.getArea({start:e,end:t});this.setSelectionRange(l,o),this.insert("");const r=this.getPositionFromLineCol(s);this.setSelectionRange(r,r),this.scrollIntoView()}},l=class extends HTMLTextAreaElement{static get observedAttributes(){return["tabsize","tabstyle","comments"]}buffer;pageSize=10;constructor(){super(),this.setAttribute("wrap","off"),this.style.whiteSpace="pre",this.buffer=new s(this,i),this.attachEvents()}updateSizes(){const e=parseFloat(window.getComputedStyle(this).getPropertyValue("line-height"))||16;this.pageSize=Math.floor(this.offsetHeight/e)-1}attachEvents(){new ResizeObserver((()=>this.updateSizes())).observe(this),this.addEventListener("keydown",(t=>{const i=t.ctrlKey||t.metaKey;if(document.activeElement===this){if(i){if("/"===t.key)return t.preventDefault(),void this.buffer.toggleSingleComment();if("?"===t.key)return t.preventDefault(),void this.buffer.toggleDoubleComment();if("D"===t.key)return t.preventDefault(),void this.buffer.duplicate()}if((t.altKey||i&&t.shiftKey)&&["ArrowUp","ArrowDown","PageUp","PageDown"].includes(t.key))return t.preventDefault(),void this.buffer.moveLines({ArrowUp:-1,ArrowDown:1,PageUp:-this.pageSize,PageDown:this.pageSize}[t.key]);if(t.shiftKey&&"Delete"===t.key)return t.preventDefault(),void this.buffer.deleteLine();if(!i&&!t.altKey){if("Tab"===t.key){t.preventDefault();const{selectionStart:e,selectionEnd:i}=this;return void(e!==i||t.shiftKey?this.buffer.indent(t.shiftKey):(this.buffer.insert(this.buffer.tab),this.buffer.scrollIntoView()))}if("Home"===t.key)return t.preventDefault(),void this.buffer.moveCaretHome(t.shiftKey);if("End"===t.key)return t.preventDefault(),void this.buffer.moveCaretEnd(t.shiftKey);if(["PageUp","PageDown"].includes(t.key))return t.preventDefault(),void this.buffer.moveCaretLines("PageUp"===t.key?-this.pageSize:+this.pageSize,t.shiftKey)}if(!i&&!t.altKey&&!t.shiftKey&&"Enter"===t.key){const{start:i,selectionStart:n}=this.buffer.getRange(),s=this.buffer.lineAt(i.line-1),l=e(s);if(l>0){t.preventDefault();let e="\n"+s.slice(0,l-1);~"{[(".indexOf(s.at(-1))&&i.col===s.length+1&&(e+=this.buffer.tab);const o=n+e.length;return this.buffer.insert(e),this.buffer.setSelectionRange(o,o),void this.buffer.scrollIntoView()}}}}))}attributeChangedCallback(e,t,i){"tabsize"===e&&(this.buffer.options.tabSize=parseInt(i||"")||2),"tabstyle"===e&&(this.buffer.options.tabStyle="spaces"===i||"tabs"===i?i:"spaces"),"comments"===e&&(this.buffer.options.comments=(i||"// /* */").split(" "))}},o=l;export{l as TextAreaCodeElement,o as default};